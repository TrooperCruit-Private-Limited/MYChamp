@page
@model MYChamp.Pages.TakeTest.IndexModel
@{
    Layout = "_Layout";
}
<section class="pt-5 pb-5 shadow-sm">
    <div class="container">
        <div class="row pt-5">
            <div class="col-12">
                <h1>Personality Test</h1>
                <div class="row">
                    <form method="post" asp-page-handler="Submit">
                        @* Include Anti-Forgery Token *@
                        @Html.AntiForgeryToken()
                        <div class="introduction">
                            <p>
                                Lila always had big dreams, dreams too big for her small coastal town. So, she decided to pack her bags and move to the city to pursue a career in journalism. The city was a whirlwind of new experiences, challenges, and opportunities. She started from the very bottom, working as an intern at a small media company, and gradually worked her way up. Lila faced many obstacles, but her determination and passion kept her going. She made a name for herself with her compelling stories that brought to light social issues often overlooked. Eventually, she got the opportunity to work for a top media company, fulfilling her lifelong dream. Lila's journey is a testament to her resilience, hard work, and unwavering belief in her dreams.
                            </p>
                        </div>
                        <div asp-validation-summary="ModelOnly"></div>
                        @for (int i = 0; i < Model.TestAttemptModel.QuestionsList.Count && i < 20; i++)
                        {
                            var question = Model.TestAttemptModel.QuestionsList[i];
                            <div class="question" data-question-index="@i" style="display:@(i == 0 ? "block" : "none"); overflow-y: auto;">
                                <h4>@question.Question</h4>
                                <input type="hidden" asp-for="TestAttemptModel.QuestionsList[i].Id" />
                                <input type="hidden" asp-for="TestAttemptModel.QuestionsList[i].Question" />

                                @for (int j = 0; j < question.Options?.Count; j++)
                                {
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" asp-for="TestAttemptModel.QuestionsList[i].SelectedOption" value="@j" id="option-@i-@j" />
                                        <label class="form-check-label" for="option-@i-@j">
                                            @question.Options[j]
                                        </label>
                                    </div>
                                }
                            </div>
                        }


                        <div class="navigation-buttons">
                            <button type="button" id="prevBtn" class="btn btn-secondary" style="display:none;">Previous</button>
                            <button type="button" id="nextBtn" class="btn btn-secondary">Next</button>
                            <button type="submit" id="submitBtn" class="btn btn-primary" style="display:none;">Submit</button>
                        </div>

                        <input type="hidden" id="currentQuestionIndex" asp-for="CurrentQuestionIndex" />
                        <input type="hidden" asp-for="TestAttemptModel.TestId" />
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    $(document).ready(function () {
        var totalQuestions = $(".question").length;
        var currentQuestionIndex = parseInt($("#currentQuestionIndex").val()) || 0;

        function showQuestion(index) {
            $(".question").hide();
            $(".question[data-question-index=" + index + "]").show();
            $("#currentQuestionIndex").val(index);

            if (index === 0) {
                $("#prevBtn").hide();
            } else {
                $("#prevBtn").show();
            }

            if (index === totalQuestions - 1) {
                $("#nextBtn").hide();
                $("#submitBtn").show();
            } else {
                $("#nextBtn").show();
                $("#submitBtn").hide();
            }
        }

        $("#nextBtn").click(function () {
            if (currentQuestionIndex < totalQuestions - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            }
        });

        $("#prevBtn").click(function () {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        });

        // Initialize the first question
        showQuestion(currentQuestionIndex);
    });
</script>
